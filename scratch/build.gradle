plugins {
  id "com.moowork.node" version "1.2.0"
}

task copyIcon(type: Copy) {
    from 'favicon.ico'
    into 'dist/'
}

project.afterEvaluate {
    tasks.npm_install.outputs.dir(file('node_modules'))
}

task npmBuildProd(type: NpmTask) {
    inputs.files(fileTree('node_modules'))
    inputs.files(fileTree('src'))
    inputs.file('package.json')
    inputs.file('webpack.config.js')
    
    outputs.dir('dist')
 
    dependsOn npm_install
    args = ['run', 'build:prod']
}

task install {
    dependsOn copyIcon
    dependsOn npmBuildProd
}

assemble.dependsOn(install)

